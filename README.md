# 聊天网站

一个基于 Flask 的现代化聊天网站，风格模仿 OpenWebUI，支持多用户协作聊天和 AI 模型集成。

## 功能特性

### 核心功能
- ✅ 用户注册和登录系统
- ✅ 多话题聊天管理
- ✅ 实时聊天界面
- ✅ 响应式设计，深色主题风格

### 权限管理
- ✅ **对话权限控制**：可以设置对话为公开或私有
- ✅ **用户权限选择**：私有对话可以指定可访问的用户列表
- ✅ **消息发送权限**：所有有权限访问对话的用户都可以发送消息
- ✅ **权限过滤**：用户只能看到有权限访问的对话

### AI 模型集成
- ✅ **OpenAI 兼容 API 支持**：支持 OpenAI API 和兼容的 API 服务
- ✅ **服务提供商配置**：可以配置多个 API 服务提供商，支持自定义 API 端点
- ✅ **模型选择**：创建对话时可选择是否启用 AI 模型，并选择具体模型（GPT-3.5 Turbo、GPT-4 等）
- ✅ **@模型功能**：只有消息中包含 @模型/@model/@ai 等关键词时才会调用 AI 生成回复（类似 ChatGPT OpenWebUI）

### 用户管理
- ✅ **密码修改**：用户可以修改自己的密码
- ✅ **管理员功能**：管理员可以管理所有用户（编辑权限、重置密码、删除用户）
- ✅ **用户管理界面**：独立的管理员管理页面

### 界面特性
- ✅ 深色主题，低调不醒目
- ✅ 用户头像显示用户名首字母
- ✅ 简洁的对话标题显示

## 安装和运行

### 环境要求
- Python 3.8+
- pip

### 安装步骤

1. 安装依赖：
```bash
pip install -r requirements.txt
```

2. 初始化数据库：
```bash
python init_db.py
```

3. （可选）如果已有数据库，运行迁移脚本：
```bash
python migrate_db.py
```

4. 运行应用：
```bash
python app.py
```

或者使用 Windows 批处理文件：
```bash
run.bat
```

5. 访问网站：
打开浏览器访问 http://localhost:5000

## 默认账户

首次运行后，可以使用以下默认账户登录：
- 用户名: `admin`
- 密码: `admin123`
- 权限: 管理员

**⚠️ 安全提示**：建议首次登录后立即修改密码。

## 使用指南

### 基本使用

1. **注册/登录**
   - 首次使用需要注册账户
   - 使用管理员账户可以管理其他用户

2. **创建对话**
   - 点击左侧"+"按钮创建新对话
   - 可以设置对话标题、权限（公开/私有）、可访问用户
   - 可以选择是否启用 AI 模型

3. **发送消息**
   - 所有有权限访问对话的用户都可以发送消息
   - 如果启用了 AI 模型，在消息中使用 `@模型` 或 `@model` 来调用 AI 生成回复

4. **服务配置**
   - 点击侧边栏"服务配置"按钮
   - 添加 OpenAI API 密钥或兼容的 API 服务配置
   - 可以设置默认服务提供商

### AI 模型使用

1. **配置服务提供商**
   - 进入"服务配置"页面
   - 添加 API 密钥和基础 URL（可选）
   - 可以配置多个服务提供商并设置默认

2. **启用 AI 模型**
   - 创建或编辑对话时，勾选"启用 AI 模型"
   - 选择要使用的模型（如 GPT-3.5 Turbo、GPT-4 等）

3. **调用 AI**
   - 在消息中输入 `@模型`、`@model`、`@ai`、`@助手` 等关键词
   - AI 会自动生成回复
   - 关键词会被自动移除，只保留实际内容发送给 AI

### 管理员功能

1. **用户管理**
   - 管理员登录后，点击"用户管理"进入管理页面
   - 可以查看所有用户列表
   - 可以编辑用户权限（设置为管理员）
   - 可以重置用户密码
   - 可以删除用户（不能删除自己）

2. **权限设置**
   - 对话创建者可以编辑对话权限
   - 可以设置为公开（所有用户可见）或私有
   - 私有对话可以指定可访问的用户列表

## 项目结构

```
chat_website/
├── app.py                 # Flask 应用主文件
├── models.py              # 数据库模型
├── init_db.py             # 数据库初始化脚本
├── migrate_db.py          # 数据库迁移脚本
├── requirements.txt       # Python 依赖
├── run.bat                # Windows 启动脚本
├── templates/             # HTML 模板
│   ├── base.html
│   ├── login.html
│   ├── register.html
│   ├── chat.html
│   ├── change_password.html
│   └── admin.html
└── static/                # 静态文件
    ├── css/
    │   └── style.css
    └── js/
        ├── main.js
        ├── chat.js
        └── admin.js
```

## 技术栈

- **后端**：Flask, Flask-Login, Flask-SQLAlchemy
- **数据库**：SQLite
- **前端**：原生 JavaScript, CSS3
- **AI 集成**：OpenAI API (兼容其他 OpenAI 格式的 API)

## 注意事项

1. **数据库迁移**：应用启动时会自动检测并迁移数据库，添加新字段和表
2. **API 配置**：使用 AI 功能前需要配置有效的 API 密钥
3. **安全性**：生产环境请修改 `SECRET_KEY` 配置
4. **权限控制**：只有管理员可以访问用户管理功能

## 开发说明

- 数据库文件：`instance/chat.db`（SQLite）
- 调试模式：开发时 `app.py` 默认开启 debug 模式
- 端口：默认运行在 5000 端口

## 许可证

本项目仅供学习和参考使用。

